(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{74:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return u}));var o=n(3),a=n(7),r=(n(0),n(88)),s={id:"usage",title:"Usage",sidebar_label:"Usage",slug:"/usage/"},i={unversionedId:"usage",id:"usage",isDocsHomePage:!1,title:"Usage",description:"Before you can interact with your storage, it has to be configured and initiated.",source:"@site/docs/usage.md",slug:"/usage/",permalink:"/docs/usage/",version:"current",sidebar_label:"Usage",sidebar:"Getting Started",previous:{title:"Installation",permalink:"/docs/"}},c=[{value:"Using the StorageProvider",id:"using-the-storageprovider",children:[]},{value:"Passing Configs",id:"passing-configs",children:[]},{value:"Using Storage",id:"using-storage",children:[]}],p={toc:c};function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Before you can interact with your storage, it has to be configured and initiated."),Object(r.b)("h3",{id:"using-the-storageprovider"},"Using the StorageProvider"),Object(r.b)("p",null,"The simplest way to do this, is to place the Provider component exported by this library as a wrapper inside the main App component:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-jsx"}),"// App.js\nimport { StorageProvider } from 'react-async-storage'\nimport React from 'react'\n\nexport default function App() {\n    return <StorageProvider>{/* Rest of your app code */}</StorageProvider>\n}\n")),Object(r.b)("p",null,"The Provider does not need to be the top-most container in the App, but it should wrap all components that need to interact with the storage using the library's ",Object(r.b)("inlineCode",{parentName:"p"},"useStorage")," hook, and all code that needs to make calls to the async storage during the App's first render. For example:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-jsx"}),"// App.js\nimport { StorageProvider } from 'react-async-storage'\nimport React from 'react'\n\nimport { MyReduxStoreProvider } from './store'\n\nexport default function App() {\n    return (\n        <React.Fragment>\n            <StorageProvider>\n                <MyReduxStoreProvider>\n                    {/* Rest of your app code */}\n                </MyReduxStoreProvider>\n            </StorageProvider>\n        </React.Fragment>\n    )\n}\n")),Object(r.b)("p",null,"In the above example, the ReduxStoreProvider is located inside the StorageProvider tag to ensure async store actions can rely on the async storage during the init process."),Object(r.b)("h3",{id:"passing-configs"},"Passing Configs"),Object(r.b)("p",null,"You can pass configs to the provider using the ",Object(r.b)("inlineCode",{parentName:"p"},"options")," prop. This prop accepts either a config object or an array of config objects:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-jsx"}),'// App.js\nimport { StorageProvider } from "react-async-storage"\nimport React from \'react\'\n\nconst storageConfigs = [\n  {\n    storeName: "mainStore",\n    version: "1.0.1",\n  },\n  {\n    storeName: "otherStore",\n    version "1.0.0",\n  }\n]\n\nexport default function App() {\n  return (\n    <StorageProvider options={storageConfigs}>{/* Rest of your app code */}</StorageProvider>\n  )\n}\n')),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Note: this is completely optional - if you do not pass configs, the library's DEFAULTS ",Object(r.b)("strong",{parentName:"p"},"(INSERT LINK)")," will be used.")),Object(r.b)("h3",{id:"using-storage"},"Using Storage"),Object(r.b)("p",null,"With the ",Object(r.b)("inlineCode",{parentName:"p"},"StorageProvider")," in place, you can now use the storage in one of 3 ways:"),Object(r.b)("h4",{id:"1-usestorage-hook"},"1. useStorage Hook"),Object(r.b)("p",null,"If you are using functional components, you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"useStorage")," hook, which offers a convenient way to access a store inside a react component."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-tsx"}),'import { useStorage } from "react-async-storage"\nimport React, { useState, useEffect } from \'react\'\n\nexport default function MyComponent() {\n  const [myCachedValue, setMyCachedValue] = useState<MyInterface | null>(null)\n  /*\n    useStorage receives an optional string as a parameter - each representing a "storeName".\n    If no parameter is provided it will return the default store name.\n  */\n  const mainStore = useStorage("mainStore")\n\n  useEffect(() => {\n    /*\n      Interacting with the store for getItem/setItem/removeItem method calls is async.\n      It should therefore happen inside an async function call or a useEffect block inside a component.\n    */\n    ;(async () => {\n      const cachedValue = await mainStore.getItem<MyInterface>("someCacheKey")\n      setMyCachedValue(cachedValue)\n    })()\n  }, [])\n  ...\n}\n')),Object(r.b)("h4",{id:"2-using-the-storagecontext"},"2. using the StorageContext"),Object(r.b)("p",null,"If you are using class based components, you can use the StorageContext directly in your component, for example using the contextType property:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-tsx"}),'import { StorageContext } from "react-async-storage"\nimport { User } from "../types"\nimport ApiClient from "../api"\nimport React, { Component } from \'react\'\n\n\nclass MyComponent extends Component {\n  static contextType = StorageContext\n\n  async fetchUser(): Promise<User> {\n    /*\n    The StorageContext is a map of storeNames -> stores. It can be interacted with like a regular object.\n    If no parameter is provided it will try to return the default store name.\n    */\n    const { mainStore } = this.context\n\n    if (mainStore.hasItem("someKey")) {\n      return await mainStore.getItem<User>("someKey")\n    } else {\n      const user = await ApiClient.get<User>("/user")\n      await mainStore.setItem("someKey", user)\n      return user\n    }\n\n    ...\n  }\n}\n')),Object(r.b)("h4",{id:"3-using-the-getstorage-helper"},"3. using the getStorage helper"),Object(r.b)("p",null,"The previous two options work nicely for react components, but what if you want to use a store outside of a react component? For this purpose you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"getStorage")," helper. For example, this is a how it can be used inside a ",Object(r.b)("inlineCode",{parentName:"p"},"Redux Thunk")," async action:"),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-ts"}),"import { getStorage } from 'react-async-storage'\nimport { TypedThunkResult, TypedThunkDispatch, User } from '../types'\nimport ApiClient from '../api'\n\nexport function getUser(): TypedThunkResult {\n    return async (dispatch: TypedThunkDispatch) => {\n        /*\n        getStorage receives an optional string as a parameter.\n        If no parameter is provided it will try to return the default store name.\n        */\n        const mainStore = getStorage('mainStore')\n\n        const user = mainStore.hasItem('someKey')\n            ? await mainStore.getItem<User>('someKey')\n            : await ApiClient.get<User>('/user')\n\n        dispatch({\n            type: SET_USER,\n            payload: user,\n        })\n    }\n}\n")),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"IMPORTANT")," when using ",Object(r.b)("inlineCode",{parentName:"p"},"getStorage"),", care must be given to use it only in code that is called after the ",Object(r.b)("inlineCode",{parentName:"p"},"StorageProvider")," has been initialized. The simplest way to ensure this, is to wrap every place where ",Object(r.b)("inlineCode",{parentName:"p"},"getStorage")," is called inside the ",Object(r.b)("inlineCode",{parentName:"p"},"StorageProvider"),"."))}u.isMDXComponent=!0}}]);